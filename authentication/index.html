<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="George Cushen">
        <link rel="canonical" href="http://gcushen.github.io/mezzanine-api/authentication/">
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Authentication - Mezzanine REST API</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-62992791-1', 'auto');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Mezzanine REST API</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Authentication</a>
                    </li>
                
                
                
                    <li >
                        <a href="../release-notes/">Release notes</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../release-notes/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/gcushen/mezzanine-api/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#authentication">Authentication</a></li>
        
            <li><a href="#oauth2-authentication">OAuth2 authentication</a></li>
        
            <li><a href="#basic-authentication">Basic authentication</a></li>
        
            <li><a href="#session-authentication">Session authentication</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="authentication">Authentication</h1>
<p>There are three options for authenticating with the API. The most appropriate option can be determined by considering if the API client is:</p>
<ul>
<li>another Django app running on the site (such as the built-in browsable API)? Use <em>session</em> authentication.</li>
<li>a desktop/web/mobile client accessing the site externally? Use <em>OAuth2</em> authentication.</li>
<li>a very simple external client mainly for development and debugging? Use <em>basic</em> authentication.</li>
</ul>
<p>In the following sections, we explore how these different approaches can be used. It is assumed that you have already created a superuser account in Mezzanine.</p>
<h2 id="oauth2-authentication">OAuth2 authentication</h2>
<p>OAuth2 is the industry standard for API authentication and should be used to handle external API clients. 
With OAuth authentication, users can login to the OAuth2 App Manager and generate access tokens to authorize clients to access the API on their behalf. 
This access can be revoked by users at any point, for example if the access token falls into the wrong hands. 
A fresh access token can then be easily generated if neccessary.</p>
<h3 id="creating-an-app">Creating an app</h3>
<p>Open up the local OAuth2 App Manager at <a href="http://127.0.0.1:8000/api/oauth2/applications/register/">http://127.0.0.1:8000/api/oauth2/applications/register/</a> in your browser. (If you are using API version &lt;= 0.3.0, you may experience a 404 error. To resolve this, add the line <code>LOGIN_URL = "/api/auth/login/"</code> to your <code>settings.py</code>.)</p>
<p>OAuth2 provides <em>client types</em> and <em>grant types</em> for different API use cases. The client types consider whether a secret can be kept safe on the API client. They are defined as:</p>
<ul>
<li><strong>Confidential</strong> for server-side apps running on a web server</li>
<li><strong>Public</strong> for JavaScript apps running in a web browser, desktop PC/laptop apps, or mobile apps</li>
</ul>
<p>And the available grant types are as follows:</p>
<ul>
<li><strong>Authorization Code</strong> for server-side apps</li>
<li><strong>Implicit</strong> for browser-based or mobile apps</li>
<li><strong>Password</strong> for logging in with a username and password</li>
<li><strong>Client credentials</strong> for apps to access their own account, outside the context of any specific user</li>
</ul>
<p>Thus, for a mobile client app, we would choose the <em>Public</em> client type and the <em>Implicit</em> grant type. </p>
<p>However, for this example, we consider a server-side app. Go ahead and register a new OAuth application. Just enter a reference name, choose <code>confidential</code> client type and 
<code>...password-based</code> authorization grant type:</p>
<p><img alt="OAuth Screenshot" src="../img/oauth_register.png" /></p>
<h3 id="receiving-an-access-token">Receiving an Access Token</h3>
<p>Request your access token to use for API authentication:</p>
<pre><code>$ curl -X POST -H "Accept: application/json; indent=4" \
  -d "grant_type=password&amp;username=&lt;username&gt;&amp;password=&lt;password&gt;" -u"&lt;client_id&gt;:&lt;client_secret&gt;" \
  http://localhost:8000/api/oauth2/token/
</code></pre>
<p>For <code>client_id</code> and <code>client_secret</code>, copy and paste those that you were given in the previous step. The <code>username</code> and 
<code>password</code> are the credentials of the Mezzanine user you wish to login as. You will get a JSON response like:</p>
<pre><code>{
    "access_token": "**&lt;your_access_token&gt;**",
     ...
}
</code></pre>
<h3 id="testing-an-app-as-client-owner">Testing an app as client owner</h3>
<p>The following test should <em>fail</em> (i.e. no user listings shown) if you are not currently authenticated:</p>
<pre><code>$ curl http://localhost:8000/api/users

{
    "detail": "Authentication credentials were not provided."
}
</code></pre>
<p>The following authenticated test should <em>succeed</em> and show you a list of users if you registered OAuth with a 
<em>superuser</em> account:    </p>
<pre><code>$ curl -H "Authorization: Bearer &lt;your_access_token&gt;" http://localhost:8000/api/users
</code></pre>
<p>You can also test your access token by entering it at the top of your local interactive API Resource Documentation page at <a href="http://127.0.0.1:8000/api/docs/">http://127.0.0.1:8000/api/docs/</a>.</p>
<h2 id="basic-authentication">Basic authentication</h2>
<p>Due to the complexity of OAuth2 authentication, basic authentication can be useful during development. 
However, basic authentication requires trusting your sensitive credentials with API client applications and passing your username and password on every request, so it is strongly discouraged for production use.</p>
<h3 id="testing">Testing</h3>
<p>The following test should <em>fail</em> (i.e. no user listings shown) if you are not currently authenticated:</p>
<pre><code>$ curl http://localhost:8000/api/users

{
    "detail": "Authentication credentials were not provided."
}
</code></pre>
<p>The following authenticated test should <em>succeed</em> and show you a list of users if you enter credentials of a Mezzanine <em>superuser</em> account:    </p>
<pre><code>$ curl --user '&lt;your_username&gt;:&lt;your_password&gt;' http://localhost:8000/api/users
</code></pre>
<h2 id="session-authentication">Session authentication</h2>
<p>Session authentication is enabled primarily for the Browsable Web API. If you wish to use session based authentication for write access as well as read access, you will need to setup a valid CSRF token for any PUT or POST requests. See the <a href="https://docs.djangoproject.com/en/dev/ref/csrf/#ajax">Django CSRF documentation</a> for more details.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright &copy; 2015 <a href="https://twitter.com/GeorgeCushen">George Cushen</a>.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
